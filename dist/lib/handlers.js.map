{"version":3,"sources":["../../lib/handlers.js"],"names":[],"mappings":"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","file":"lib/handlers.js","sourcesContent":["/*───────────────────────────────────────────────────────────────────────────*\\\n │  Copyright (C) 2016 PayPal                                                 │\n │                                                                            │\n │  Licensed under the Apache License, Version 2.0 (the \"License\");           │\n │  you may not use this file except in compliance with the License.          │\n │  You may obtain a copy of the License at                                   │\n │                                                                            │\n │    http://www.apache.org/licenses/LICENSE-2.0                              │\n │                                                                            │\n │  Unless required by applicable law or agreed to in writing, software       │\n │  distributed under the License is distributed on an \"AS IS\" BASIS,         │\n │  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  │\n │  See the License for the specific language governing permissions and       │\n │  limitations under the License.                                            │\n \\*───────────────────────────────────────────────────────────────────────────*/\nimport shush from 'shush';\nimport async from 'async';\nimport Shortstop from 'shortstop'\nimport { path as createPath } from 'shortstop-handlers';\n\n\nexport default class Handlers {\n\n    static resolveConfig(data) {\n        return new Promise((resolve, reject) => {\n            let usedHandler = false;\n\n            let shorty = Shortstop.create();\n            shorty.use('config', function (key) {\n                usedHandler = true;\n\n                let keys = key.split('.');\n                let result = data;\n\n                while (result && keys.length) {\n                    let prop = keys.shift();\n                    if (!result.hasOwnProperty(prop)) {\n                        return undefined;\n                    }\n                    result = result[prop];\n                }\n\n                return keys.length ? null : result;\n            });\n\n            async.doWhilst(\n                function exec(cb) {\n                    usedHandler = false;\n                    shorty.resolve(data, function (err, result) {\n                        if (err) {\n                            cb(err);\n                            return;\n                        }\n                        data = result;\n                        cb();\n                    });\n                },\n\n                function test() {\n                    return usedHandler;\n                },\n\n                function complete(err) {\n                    if (err) {\n                        reject(err);\n                        return;\n                    }\n                    resolve(data);\n                }\n            );\n        });\n    }\n\n    static resolveImport(data, basedir) {\n        return new Promise((resolve, reject) => {\n            let path = createPath(basedir);\n            let shorty = Shortstop.create();\n\n            shorty.use('import', function (file, cb) {\n                try {\n                    file = path(file);\n                    return shorty.resolve(shush(file), cb);\n                } catch (err) {\n                    cb(err);\n                }\n            });\n\n            shorty.resolve(data, function (err, data) {\n                if (err) {\n                    reject(err);\n                    return;\n                }\n                resolve(data);\n            });\n        });\n    }\n\n    static resolveCustom(data, protocols) {\n        return new Promise(function (resolve, reject) {\n            let shorty = Shortstop.create();\n\n            for (let protocol of Object.keys(protocols)) {\n                let impls = protocols[protocol];\n                \n                if (Array.isArray(impls)) {\n                    for (let impl of impls) {\n                        shorty.use(protocol, impl);\n                    }\n                } else {\n                    shorty.use(protocol, impls);\n                }\n            }\n\n            shorty.resolve(data, function (err, data) {\n                if (err) {\n                    reject(err);\n                    return;\n                }\n                resolve(data);\n            });\n        });\n\n    }\n}\n"]}